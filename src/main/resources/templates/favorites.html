<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>StockCoin - ê´€ì‹¬ì¢…ëª©</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/favorites.css" rel="stylesheet">
  <style>
    /* ë°ëª¨ í¸ì˜ìš©(ì›í•˜ë©´ favorites.cssë¡œ ì´ë™) */
    .star { cursor: pointer; font-size: 20px; }
    .star.active { color: #f5c518; } /* ê³¨ë“œ */
    .table thead th { vertical-align: middle; user-select: none; cursor: pointer; }
    .th-non-sort { cursor: default !important; }
    .sort-icon { font-size: 12px; opacity: .6; margin-left: 6px; }
    .empty-hint { color:#888; font-size: 0.95rem; }
  </style>
</head>
<body class="d-flex flex-column min-vh-100">
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
    <div class="container-fluid">
      <a class="navbar-brand fw-bold" href="/">ğŸ“ˆ StockCoin</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="/">í™ˆ</a></li>
          <li class="nav-item"><a class="nav-link" href="/priceStock">ì‹œì„¸ë³´ê¸°</a></li>
          <li class="nav-item"><a class="nav-link active" href="/favorites" aria-current="page">ê´€ì‹¬ì¢…ëª©</a></li>
          <li class="nav-item"><a class="nav-link" href="/chat">ì±„íŒ…</a></li>
          <li class="nav-item"><a class="nav-link" href="/join">íšŒì›ê°€ì…</a></li>
          <li class="nav-item"><a class="nav-link" href="/login">ë¡œê·¸ì¸</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Main -->
  <main class="flex-fill container my-5">
    <div class="d-flex align-items-center justify-content-between mb-3">
      <h2 class="mb-0">â­ ë‚˜ì˜ ê´€ì‹¬ì¢…ëª©</h2>
      <small class="text-muted">* ë°ëª¨: í”„ë¡ íŠ¸ì—ì„œë§Œ â­/ì •ë ¬/ê²€ìƒ‰ ë™ì‘ (ìƒˆë¡œê³ ì¹¨ ì‹œ ì´ˆê¸°í™”)</small>
    </div>

    <div class="row g-4">
      <!-- ì¢Œ: ì£¼ì‹ ê´€ì‹¬ì¢…ëª© -->
      <div class="col-md-6">
        <div class="d-flex align-items-center justify-content-between mb-2">
          <h4 class="mb-0">ì£¼ì‹ ê´€ì‹¬ì¢…ëª©</h4>
          <div class="input-group" style="max-width: 240px;">
            <input id="stockSearch" type="text" class="form-control form-control-sm" placeholder="ì¢…ëª©ëª…/ì½”ë“œ ê²€ìƒ‰">
            <button id="stockClear" class="btn btn-outline-secondary btn-sm">ì§€ìš°ê¸°</button>
          </div>
        </div>

        <div class="table-responsive">
          <table class="table table-hover text-center align-middle" id="stockTable">
            <thead class="table-dark">
              <tr>
                <th data-key="name">ì¢…ëª©ëª… <span class="sort-icon" id="stockSortName">â†•</span></th>
                <th data-key="price">í˜„ì¬ê°€ <span class="sort-icon" id="stockSortPrice">â†•</span></th>
                <th data-key="chg">ë³€ë™ë¥  <span class="sort-icon" id="stockSortChg">â†•</span></th>
                <th class="th-non-sort">â­</th>
              </tr>
            </thead>
            <tbody><!-- JS ë Œë”ë§ --></tbody>
          </table>
        </div>
        <div id="stockEmpty" class="empty-hint d-none">ë“±ë¡ëœ ì£¼ì‹ ê´€ì‹¬ì¢…ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</div>
      </div>

      <!-- ìš°: ì½”ì¸ ê´€ì‹¬ì¢…ëª© -->
      <div class="col-md-6">
        <div class="d-flex align-items-center justify-content-between mb-2">
          <h4 class="mb-0">ì½”ì¸ ê´€ì‹¬ì¢…ëª©</h4>
          <div class="input-group" style="max-width: 240px;">
            <input id="coinSearch" type="text" class="form-control form-control-sm" placeholder="ì½”ì¸ëª…/ì½”ë“œ ê²€ìƒ‰">
            <button id="coinClear" class="btn btn-outline-secondary btn-sm">ì§€ìš°ê¸°</button>
          </div>
        </div>

        <div class="table-responsive">
          <table class="table table-hover text-center align-middle" id="coinTable">
            <thead class="table-dark">
              <tr>
                <th data-key="name">ì½”ì¸ëª… <span class="sort-icon" id="coinSortName">â†•</span></th>
                <th data-key="price">í˜„ì¬ê°€ <span class="sort-icon" id="coinSortPrice">â†•</span></th>
                <th data-key="chg">ë³€ë™ë¥  <span class="sort-icon" id="coinSortChg">â†•</span></th>
                <th class="th-non-sort">â­</th>
              </tr>
            </thead>
            <tbody><!-- JS ë Œë”ë§ --></tbody>
          </table>
        </div>
        <div id="coinEmpty" class="empty-hint d-none">ë“±ë¡ëœ ì½”ì¸ ê´€ì‹¬ì¢…ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-dark text-light text-center py-3 mt-auto">
    <p class="mb-0">Â© 2025 StockCoin Project</p>
  </footer>

  <script>
    // ========== ë°ëª¨ ë°ì´í„° (ë‚˜ì¤‘ì— DB ì—°ë™ìœ¼ë¡œ êµì²´) ==========
    let stockFavs = [
      { code: "005930", name: "ì‚¼ì„±ì „ì", price: 72300,  chg: +0.8 },
      { code: "005380", name: "í˜„ëŒ€ì°¨",   price: 184000, chg: +1.3 }
    ];
    let coinFavs = [
      { code: "KRW-BTC", name: "BTC", price: 96500000, chg: +2.1 },
      { code: "KRW-ETH", name: "ETH", price: 5200000,  chg: -0.5 }
    ];

    // ========== ìœ í‹¸ ==========
    const fmtPrice = (n) => n.toLocaleString();
    const chgClass = (v) => v >= 0 ? "text-danger" : "text-primary";
    const chgText  = (v) => (v >= 0 ? "+" : "") + v.toFixed(1) + "%";

    // ========== ë Œë”ë§ ==========
    function renderTable(tbody, list) {
      tbody.innerHTML = "";
      list.forEach(item => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="text-start">${item.name} <small class="text-muted">(${item.code})</small></td>
          <td>${fmtPrice(item.price)}</td>
          <td class="${chgClass(item.chg)}">${chgText(item.chg)}</td>
          <td><span class="star active" data-code="${item.code}" title="ì¦ê²¨ì°¾ê¸° í•´ì œ">â˜…</span></td>
        `;
        tbody.appendChild(tr);
      });
    }

    function updateEmptyHint(list, emptyEl) {
      if (list.length === 0) emptyEl.classList.remove("d-none");
      else emptyEl.classList.add("d-none");
    }

    // ========== ì´ˆê¸° ë Œë” ==========
    const stockTbody = document.querySelector("#stockTable tbody");
    const coinTbody  = document.querySelector("#coinTable tbody");
    const stockEmpty = document.getElementById("stockEmpty");
    const coinEmpty  = document.getElementById("coinEmpty");

    function renderAll() {
      renderFiltered(); // ê²€ìƒ‰ ë°˜ì˜í•´ì„œ ë Œë”
    }

    // ========== â­ í† ê¸€(í•´ì œ) ==========
    document.addEventListener("click", (e) => {
      if (e.target.classList.contains("star")) {
        const code = e.target.getAttribute("data-code");

        // ì£¼ì‹ì—ì„œ ì œê±°
        const sIdx = stockFavs.findIndex(i => i.code === code);
        if (sIdx > -1) {
          stockFavs.splice(sIdx, 1);
          return renderAll();
        }
        // ì½”ì¸ì—ì„œ ì œê±°
        const cIdx = coinFavs.findIndex(i => i.code === code);
        if (cIdx > -1) {
          coinFavs.splice(cIdx, 1);
          return renderAll();
        }
      }
    });

    // ========== ê²€ìƒ‰(í´ë¼ì´ì–¸íŠ¸ í•„í„°) ==========
    function filterList(list, keyword) {
      const k = keyword.trim().toLowerCase();
      if (!k) return list;
      return list.filter(i =>
        i.name.toLowerCase().includes(k) || i.code.toLowerCase().includes(k)
      );
    }

    function renderFiltered() {
      const ks = document.getElementById("stockSearch").value;
      const kc = document.getElementById("coinSearch").value;

      const sFiltered = filterList([...stockFavs], ks);
      const cFiltered = filterList([...coinFavs],  kc);

      renderTable(stockTbody, sFiltered);
      renderTable(coinTbody,  cFiltered);

      updateEmptyHint(sFiltered, stockEmpty);
      updateEmptyHint(cFiltered, coinEmpty);

      // ì •ë ¬ ì•„ì´ì½˜ ì¬í‘œì‹œ
      applySortIcon("stock", stockSort.key, stockSort.asc);
      applySortIcon("coin",  coinSort.key,  coinSort.asc);
    }

    document.getElementById("stockSearch").addEventListener("input", renderFiltered);
    document.getElementById("coinSearch").addEventListener("input", renderFiltered);
    document.getElementById("stockClear").addEventListener("click", () => {
      document.getElementById("stockSearch").value = "";
      renderFiltered();
    });
    document.getElementById("coinClear").addEventListener("click", () => {
      document.getElementById("coinSearch").value = "";
      renderFiltered();
    });

    // ========== ì •ë ¬ ==========
    let stockSort = { key: null, asc: true };
    let coinSort  = { key: null, asc: true };

    function sortList(list, key, asc) {
      list.sort((a, b) => {
        if (typeof a[key] === 'string') {
          return asc ? a[key].localeCompare(b[key]) : b[key].localeCompare(a[key]);
        }
        return asc ? (a[key] - b[key]) : (b[key] - a[key]);
      });
    }

    function applySortIcon(type, key, asc) {
      const map = {
        stock: { name: "stockSortName", price: "stockSortPrice", chg: "stockSortChg" },
        coin:  { name: "coinSortName",  price: "coinSortPrice",  chg: "coinSortChg"  }
      }[type];

      // ì´ˆê¸°í™”
      Object.values(map).forEach(id => document.getElementById(id).textContent = "â†•");

      if (!key) return;
      const icon = document.getElementById(map[key]);
      icon.textContent = asc ? "â–²" : "â–¼";
    }

    // í…Œì´ë¸” í—¤ë” í´ë¦­ ì´ë²¤íŠ¸ (ì •ë ¬)
    document.querySelectorAll("#stockTable thead th").forEach((th) => {
      const key = th.getAttribute("data-key");
      if (!key) return; // â­ ì»¬ëŸ¼ ì œì™¸
      th.addEventListener("click", () => {
        stockSort.asc = (stockSort.key === key) ? !stockSort.asc : true;
        stockSort.key = key;
        sortList(stockFavs, key, stockSort.asc);
        applySortIcon("stock", stockSort.key, stockSort.asc);
        renderFiltered();
      });
    });

    document.querySelectorAll("#coinTable thead th").forEach((th) => {
      const key = th.getAttribute("data-key");
      if (!key) return;
      th.addEventListener("click", () => {
        coinSort.asc = (coinSort.key === key) ? !coinSort.asc : true;
        coinSort.key = key;
        sortList(coinFavs, key, coinSort.asc);
        applySortIcon("coin", coinSort.key, coinSort.asc);
        renderFiltered();
      });
    });

    // ìµœì´ˆ ë Œë”
    renderAll();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
