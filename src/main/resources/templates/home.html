<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>StockCoin - 실시간 주식·코인 시세</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/home.css" rel="stylesheet">
</head>

<body class="d-flex flex-column min-vh-100">

<!-- Navbar -->
<th:block th:replace="fragments/navbar :: navbar"></th:block>

<!-- Hero Section -->
<section class="hero-section">
    <div class="container text-center">
        <h1 class="hero-title">📈 StockCoin</h1>
        <p class="hero-subtitle">실시간 주식 & 코인 시세를 한눈에</p>
        <div class="hero-buttons">
            <a href="/priceStock" class="btn btn-hero btn-primary">주식 시세 보기</a>
            <a href="/priceCoin" class="btn btn-hero btn-success">코인 시세 보기</a>
        </div>
    </div>
</section>

<!-- Main Content -->
<main class="flex-fill container my-5">

    <!-- 오늘의 주요 시세 -->
    <section class="mb-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="section-title">🔥 오늘의 주요 종목</h2>
            <small class="text-muted">실시간 업데이트</small>
        </div>

        <div class="row g-4">
            <!-- 삼성전자 -->
            <div class="col-md-3 col-sm-6">
                <div class="price-card" th:classappend="${samsung != null && #strings.contains(samsung.changeRate, '-')} ? 'card-down' : 'card-up'">
                    <div class="card-icon">📊</div>
                    <h5 class="card-name">삼성전자</h5>
                    <p class="card-price" th:text="${samsung != null ? samsung.price + '원' : '-'}">-</p>
                    <small class="card-change"
                           th:classappend="${samsung != null && #strings.contains(samsung.changeRate, '-')} ? 'text-down' : 'text-up'"
                           th:text="${samsung != null ? (samsung.changeRate.startsWith('-') ? '▼ ' : '▲ ') + samsung.changeRate : '-'}">-</small>
                </div>
            </div>

            <!-- 현대차 -->
            <div class="col-md-3 col-sm-6">
                <div class="price-card" th:classappend="${hyundai != null && #strings.contains(hyundai.changeRate, '-')} ? 'card-down' : 'card-up'">
                    <div class="card-icon">🚗</div>
                    <h5 class="card-name">현대차</h5>
                    <p class="card-price" th:text="${hyundai != null ? hyundai.price + '원' : '-'}">-</p>
                    <small class="card-change"
                           th:classappend="${hyundai != null && #strings.contains(hyundai.changeRate, '-')} ? 'text-down' : 'text-up'"
                           th:text="${hyundai != null ? (hyundai.changeRate.startsWith('-') ? '▼ ' : '▲ ') + hyundai.changeRate : '-'}">-</small>
                </div>
            </div>

            <!-- 비트코인 -->
            <div class="col-md-3 col-sm-6">
                <div class="price-card" th:classappend="${bitcoin != null && #strings.contains(bitcoin.changeRate, '-')} ? 'card-down' : 'card-up'">
                    <div class="card-icon">₿</div>
                    <h5 class="card-name">비트코인</h5>
                    <p class="card-price" th:text="${bitcoin != null ? bitcoin.price + '원' : '-'}">-</p>
                    <small class="card-change"
                           th:classappend="${bitcoin != null && #strings.contains(bitcoin.changeRate, '-')} ? 'text-down' : 'text-up'"
                           th:text="${bitcoin != null ? (bitcoin.changeRate.startsWith('-') ? '▼ ' : '▲ ') + bitcoin.changeRate : '-'}">-</small>
                </div>
            </div>

            <!-- 이더리움 -->
            <div class="col-md-3 col-sm-6">
                <div class="price-card" th:classappend="${ethereum != null && #strings.contains(ethereum.changeRate, '-')} ? 'card-down' : 'card-up'">
                    <div class="card-icon">Ξ</div>
                    <h5 class="card-name">이더리움</h5>
                    <p class="card-price" th:text="${ethereum != null ? ethereum.price + '원' : '-'}">-</p>
                    <small class="card-change"
                           th:classappend="${ethereum != null && #strings.contains(ethereum.changeRate, '-')} ? 'text-down' : 'text-up'"
                           th:text="${ethereum != null ? (ethereum.changeRate.startsWith('-') ? '▼ ' : '▲ ') + ethereum.changeRate : '-'}">-</small>
                </div>
            </div>
        </div>
    </section>

    <!-- 실시간 차트 -->
    <section class="mb-5">
        <h2 class="section-title mb-4">📊 실시간 차트</h2>

        <div class="row g-4">
            <!-- 주식 차트 -->
            <div class="col-lg-6">
                <div class="chart-box">
                    <div class="chart-header">
                        <h4>주식 차트</h4>
                        <span class="badge bg-primary">LIVE</span>
                    </div>
                    <div class="chart-container">
                        <canvas id="stockChart"></canvas>
                    </div>
                    <a href="/priceStock" class="btn btn-outline-dark w-100 mt-3">
                        국내주식 전체보기 →
                    </a>
                </div>
            </div>

            <!-- 코인 차트 -->
            <div class="col-lg-6">
                <div class="chart-box">
                    <div class="chart-header">
                        <h4>코인 차트</h4>
                        <span class="badge bg-success">LIVE</span>
                    </div>
                    <div class="chart-container">
                        <canvas id="coinChart"></canvas>
                    </div>
                    <a href="/priceCoin" class="btn btn-outline-dark w-100 mt-3">
                        코인시세 전체보기 →
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- 최신 채팅 -->
    <section class="mb-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="section-title">💬 실시간 채팅</h2>
            <a href="/chat" class="btn btn-sm btn-dark">채팅방 입장 →</a>
        </div>

        <div class="chat-box">
            <th:block th:each="chat : ${latestChat}">
                <div class="chat-item">
                    <strong class="chat-sender" th:text="${chat.sender}"></strong>
                    <span class="chat-message" th:text="${chat.message}"></span>
                </div>
            </th:block>

            <th:block th:if="${#lists.isEmpty(latestChat)}">
                <div class="chat-empty">
                    <p>💭 아직 채팅이 없습니다. 첫 메시지를 남겨보세요!</p>
                </div>
            </th:block>
        </div>
    </section>

</main>

<!-- Footer -->
<footer class="bg-dark text-light text-center py-4 mt-auto">
    <div class="container">
        <p class="mb-2">© 2025 StockCoin Project</p>
        <small class="text-muted">실시간 주식 · 코인 시세 플랫폼</small>
    </div>
</footer>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- 차트 스크립트 -->
<script th:inline="javascript">
    /*<![CDATA[*/
    // 서버에서 전달받은 데이터
    const stockChartData = /*[[${stockChartData}]]*/ null;
    const coinChartData = /*[[${coinChartData}]]*/ null;

    // 주식 차트
    const stockCtx = document.getElementById('stockChart');
    if (stockChartData && stockChartData.labels && stockChartData.prices) {
        new Chart(stockCtx, {
            type: 'line',
            data: {
                labels: stockChartData.labels.slice(-7), // 최근 7개
                datasets: [{
                    label: '삼성전자',
                    data: stockChartData.prices.slice(-7),
                    borderColor: '#dc3545',
                    backgroundColor: 'rgba(220, 53, 69, 0.1)',
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true,
                    pointRadius: 5,
                    pointHoverRadius: 7,
                    pointBackgroundColor: '#dc3545',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top',
                        labels: {
                            font: { size: 14, weight: 'bold' },
                            color: '#2d3748'
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        padding: 12,
                        titleFont: { size: 14 },
                        bodyFont: { size: 13 },
                        cornerRadius: 8
                    }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        grid: { color: 'rgba(0,0,0,0.05)' },
                        ticks: {
                            font: { size: 12 },
                            color: '#6c757d'
                        }
                    },
                    x: {
                        grid: { display: false },
                        ticks: {
                            font: { size: 12 },
                            color: '#6c757d'
                        }
                    }
                }
            }
        });
    } else {
        // 데이터가 없을 때 기본 차트
        new Chart(stockCtx, {
            type: 'line',
            data: {
                labels: ['10:00', '10:30', '11:00', '11:30', '12:00', '12:30', '13:00'],
                datasets: [{
                    label: '삼성전자',
                    data: [70000, 70500, 70200, 71000, 71500, 72000, 72300],
                    borderColor: '#dc3545',
                    backgroundColor: 'rgba(220, 53, 69, 0.1)',
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true,
                    pointRadius: 5,
                    pointHoverRadius: 7,
                    pointBackgroundColor: '#dc3545',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: true, position: 'top' }
                },
                scales: {
                    y: { beginAtZero: false, grid: { color: 'rgba(0,0,0,0.05)' } },
                    x: { grid: { display: false } }
                }
            }
        });
    }

    // 코인 차트
    const coinCtx = document.getElementById('coinChart');
    if (coinChartData && coinChartData.labels && coinChartData.prices) {
        new Chart(coinCtx, {
            type: 'line',
            data: {
                labels: coinChartData.labels,
                datasets: [{
                    label: 'BTC',
                    data: coinChartData.prices,
                    borderColor: '#198754',
                    backgroundColor: 'rgba(25, 135, 84, 0.1)',
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true,
                    pointRadius: 5,
                    pointHoverRadius: 7,
                    pointBackgroundColor: '#198754',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top',
                        labels: {
                            font: { size: 14, weight: 'bold' },
                            color: '#2d3748'
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        padding: 12,
                        titleFont: { size: 14 },
                        bodyFont: { size: 13 },
                        cornerRadius: 8
                    }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        grid: { color: 'rgba(0,0,0,0.05)' },
                        ticks: {
                            font: { size: 12 },
                            color: '#6c757d'
                        }
                    },
                    x: {
                        grid: { display: false },
                        ticks: {
                            font: { size: 12 },
                            color: '#6c757d'
                        }
                    }
                }
            }
        });
    } else {
        // 데이터가 없을 때 기본 차트
        new Chart(coinCtx, {
            type: 'line',
            data: {
                labels: ['10:00', '10:30', '11:00', '11:30', '12:00', '12:30', '13:00'],
                datasets: [{
                    label: 'BTC',
                    data: [95000, 95500, 96000, 95800, 96200, 96500, 96800],
                    borderColor: '#198754',
                    backgroundColor: 'rgba(25, 135, 84, 0.1)',
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true,
                    pointRadius: 5,
                    pointHoverRadius: 7,
                    pointBackgroundColor: '#198754',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: true, position: 'top' }
                },
                scales: {
                    y: { beginAtZero: false, grid: { color: 'rgba(0,0,0,0.05)' } },
                    x: { grid: { display: false } }
                }
            }
        });
    }
    /*]]>*/
</script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>